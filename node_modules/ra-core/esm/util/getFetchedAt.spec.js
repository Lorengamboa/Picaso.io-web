import assert from 'assert';
import getFetchedAt from './getFetchedAt';
describe('getFetchedAt', function () {
    it('should return now date for every newRecordsId', function () {
        var cacheDuration = 10 * 60 * 1000;
        var now = new Date();
        var newRecordIds = [1, 2, 3];
        assert.deepEqual(getFetchedAt(newRecordIds, {}, now, cacheDuration), {
            1: now,
            2: now,
            3: now,
        });
    });
    it('should keep old date if it is still valid', function () {
        var cacheDuration = 10 * 60 * 1000;
        var now = new Date();
        var newRecordIds = [1, 2, 3];
        var validDate = new Date();
        validDate.setTime(now.getTime() - cacheDuration / 2);
        var oldFetchedData = {
            4: validDate,
        };
        assert.deepEqual(getFetchedAt(newRecordIds, oldFetchedData, now, cacheDuration), {
            1: now,
            2: now,
            3: now,
            4: validDate,
        });
    });
    it('should discard old date if it is not valid anymore', function () {
        var cacheDuration = 10 * 60 * 1000;
        var now = new Date();
        var newRecordIds = [1, 2, 3];
        var invalidDate = new Date();
        invalidDate.setTime(now.getTime() - cacheDuration);
        var oldFetchedData = {
            4: invalidDate,
        };
        assert.deepEqual(getFetchedAt(newRecordIds, oldFetchedData, now, cacheDuration), {
            1: now,
            2: now,
            3: now,
        });
    });
    it('should update old date if id present in newRecordsId even if not valid anymore', function () {
        var cacheDuration = 10 * 60 * 1000;
        var now = new Date();
        var newRecordIds = [1, 2, 3];
        var validDate = new Date();
        validDate.setTime(now.getTime() - cacheDuration / 2);
        var invalidDate = new Date();
        invalidDate.setTime(now.getTime() - cacheDuration);
        var oldFetchedData = {
            1: validDate,
            2: invalidDate,
        };
        assert.deepEqual(getFetchedAt(newRecordIds, oldFetchedData, now, cacheDuration), {
            1: now,
            2: now,
            3: now,
        });
    });
});
